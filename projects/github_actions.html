<!DOCTYPE html>
<html lang="en-US">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mike Smith</title>
    <link rel="icon" type="image/" href="https://mikesmith.space/image/m_background.png">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Jura">
    <link rel="stylesheet" href="../style/style.css">
    <!-- Prism.js CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <!-- Prism.js plugins -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.css"
        rel="stylesheet" />
    <!-- Prism.js copy button -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/toolbar/prism-toolbar.min.css"
        rel="stylesheet" />
</head>

<body>
    <nav id="navbar">
        <div class="nav-container">
            <div class="logo"><img src="https://mikesmith.space/image/cartoon.svg" width="68" height="102"></div>
            <div class="hamburger-menu">
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
            </div>
            <ul class="nav-links">
                <li><a href="https://mikesmith.space/">Home</a></li>
                <li><a href="https://mikesmith.space/projects.html">Projects</a></li>
                <li><a href="https://mikesmith.space/about_me.html">About Me</a></li>
                <li><a href="https://mikesmith.space/contact.html">Contact</a></li>
            </ul>
        </div>
    </nav>

    <hr margin-top: 0;>

    <section id="path" class="trail">
        <div class="trail-path">
            <a href="https://mikesmith.space/projects.html">Projects</a> > 
            <a href="https://mikesmith.space/projects/github_actions.html">GitHub Actions</a>
        </div>
    </section>

    <section id="code" class="section">
        <div class="container">
            <h2>GitHub Actions</h2>
        </div>
    </section>

    <section id="code" class="section">
        <div class="container">
            <h3>Description</h3>
            <p>
                Learning to use Github Actions feels like a valueable skill to build. This repository automatically commits
                updates to a markdown file.
            </p>
            <p>
                <a href="https://github.com/CodingAero/GithubActions" target="_blank">Link to the GitHub Repository</a>
            </p>
        </div>
    </section>

    <section id="code" class="section">
        <div class="container">
            <h3>Running the Program</h3>
            <p>
                This program is run automatically by GitHub Actions based on the cron schedule defined in the workflow YAML file.
            </p>
        </div>
    </section>

    <section id="code" class="section">
        <div class="container">
            <h3>Adding a Workflow</h3>
            <p>
                Within your repository, create a directory structure for `.github/workflows` and create a `.yml` file with a name
                describing the scripts purpose. See my workflow for an example but lets quickly cover a few aspects of this file.
            </p>
        </div>
    </section>

    <section id="code" class="section">
        <div class="container">
            <h3>Triggering the Workflow</h3>
            <p>
                The workflow is triggered by a `schedule` using a `cron` expression. The workflow contains a single job named commit,
                which executes on a standard ubuntu-latest runner.
            </p>
        </div>
    </section>

    <section id="code" class="section">
        <div class="container">
            <pre class="line-numbers"><code class="language-yml">on:
  schedule:
    - cron: '0 */8 * * *'</code></pre>
        </div>
    </section>

    <section id="code" class="section">
        <div class="container">
            <h3>Checkout the Repository</h3>
            <p>
                The first step uses the standard `actions/checkout@v2` action to prepare the runner environment. This essential
                process downloads a copy of the repository's code from GitHub onto the virtual machine running the job. By
                specifying `ref: main`, the workflow ensures it is working on the latest code from the `main` branch, allowing
                it to read existing files and make new changes.
            </p>
        </div>
    </section>

    <section id="code" class="section">
        <div class="container">
            <pre class="line-numbers"><code class="language-yml">    - name: Checkout repository
      uses: actions/checkout@v2
      with:
        ref: main</code></pre>
        </div>
    </section>

    <section id="code" class="section">
        <div class="container">
            <h3>Creating and Updating a File</h3>
            <p>
                This step executes a Bash script to manage the `test_actions.md` file and push the updated count. The script first
                checks if the file exists; if it doesn't, it's created with an initial rolling count of 1. If the file is found,
                the script uses `grep` to extract the current rolling count, increments that number by one, and uses `sed` to
                update the file with the new count. Finally, it configures Git user credentials, stages the modified file, creates
                a new commit with the message "Incremental test of Github Actions", and pushes the change back to the repository
                using the secured `GITHUB_TOKEN` for authentication.
            </p>
        </div>
    </section>

    <section id="code" class="section">
        <div class="container">
            <pre class="line-numbers"><code class="language-yml">    - name: Create file and update
      run: |
        FILE="test_actions.md"
        if [ ! -f "$FILE" ]; then
          echo "Below is a Rolling Count to test Github Actions:<br />" > "$FILE"
          echo "Rolling Count: 1" >> "$FILE"
        else
          CURRENT_COUNT=$(grep -oP 'Rolling Count: \K\d+' "$FILE")
          if [ -z "$CURRENT_COUNT" ]; then
            CURRENT_COUNT=0
          fi
          NEXT_COUNT=$((CURRENT_COUNT + 1))
          sed -i "/Rolling Count: /c\Rolling Count: $NEXT_COUNT" "$FILE"
        fi
        git config --global user.name "CodingAero"
        git config --global user.email "smithaero12@gmail.com"
        git add "$FILE"
        git commit -m "Incremental test of Github Actions"
        git push https://x-access-token:${{ secrets.GITHUB_TOKEN }}@github.com/CodingAero/GithubActions.git
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}</code></pre>
        </div>
    </section>

    <section id="code" class="section">
        <div class="container">
            <h3>Permissions</h3>
            <p>
                Github Actions will need permission to commit to your repository. This can be configured in `Settings` > `Actions` > `General`.
                Under `Workflow permissions`, check the read and write permissions option.
            </p>
        </div>
    </section>

    <section><br><br></section>

    <hr>

    <footer>
        <div class="footer-container">
            <div class="footer-links">
                <a href="https://mikesmith.space/">Home</a>
            </div>
            <div class="copyright">
                &copy; 2025 Mike Smith. All rights reserved.
            </div>
        </div>
    </footer>

    <!-- Auto Loader -->
    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/file-highlight/prism-file-highlight.min.js"></script>
    <!-- Prism.js JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/toolbar/prism-toolbar.min.js"></script>
    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js"></script>

    <script>
        const hamburger = document.querySelector(".hamburger-menu");
        const navLinks = document.querySelector(".nav-links");

        hamburger.addEventListener("click", () => {
            navLinks.classList.toggle("active");
        });
    </script>

</body>

</html>
